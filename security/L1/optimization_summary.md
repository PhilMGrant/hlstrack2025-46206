# HMAC-SHA256 优化分析报告

## 当前性能指标
- **延迟**: 784 时钟周期
- **时钟频率**: 15.00 ns (目标), 13.036 ns (估计)
- **资源利用率**: 
  - BRAM: 200/280 (71%)
  - LUT: 35829/53200 (67%)
  - FF: 21587/106400 (20%)
  - DSP: 0/220 (0%)

## 主要性能瓶颈识别

### 1. 数据流瓶颈
- HMAC 数据流中存在多个串行处理阶段
- 关键路径延迟限制了整体性能

### 2. 循环优化不足
- SHA256 主循环 (64轮) 使用 `UNROLL factor = 1`，限制了并行性
- 消息调度生成存在优化空间

### 3. 内存访问模式
- 流深度配置可能不够优化
- 数据依赖限制了流水线效率

## 优化策略

### 策略1: 循环展开与流水线优化
- 将 SHA256 主循环展开为更高级别的并行度
- 增加流水线深度以提升吞吐量

### 策略2: 数据流重构
- 优化 HMAC 数据流中的关键路径
- 减少不必要的串行依赖

### 策略3: 资源重分配
- 优化 BRAM 和 LUT 使用
- 利用空闲的 DSP 资源

## 已实施的优化措施

### 1. genPad 函数优化
- 增强并行处理能力，优化字节序转换
- 改进 XOR 操作，避免临时变量
- 优化索引计算，减少计算延迟

### 2. mergeKipad 函数优化
- 添加流水线 pragma (II = 1)
- 优化延迟约束 (min = 1, max = 2)
- 预计算 kipad 字数组，提高并行性
- 优化数据流深度配置

### 3. mergeKopad 函数优化
- 添加流水线 pragma (II = 1)
- 优化延迟约束 (min = 1, max = 2)
- 预计算 kopad 和 msgHash 字数组
- 改进数据提取和写入模式

### 4. 数据流配置优化
- 减少流深度从 64 到 32，优化资源使用
- 合理分配 FIFO 资源 (BRAM vs SRL)
- 优化 BIND_STORAGE 配置
- 调整延迟约束为更实际的范围

## 预期优化效果
- 目标延迟降低 30-50%
- 吞吐量提升 40-60%
- 资源利用率优化：减少不必要的 BRAM 使用
- 时钟频率可能提升 5-10%

## 下一步优化建议
1. 编译测试当前优化效果
2. 根据新的性能报告进一步优化 SHA256 核心
3. 考虑循环展开和流水线深度调整
4. 优化内存访问模式和数据依赖
